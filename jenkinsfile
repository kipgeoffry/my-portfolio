/* groovylint-disable CompileStatic, GStringExpressionWithinString */
pipeline {
    agent {
        node {
            label 'docker-agent-alpine'
        }
    }
    triggers {
        pollSCM '*/2 * * * *'
    }
    stages {
        stage('Log') {
            parallel {
                stage('log') {
                    steps {
                        sh 'echo "Jambo Kenya"'
                        sh '''
                            echo "Multiline shell steps works too"
                            ls -lah
                            '''
                    }
                }

                stage('view') {
                    steps {
                        sh 'whois kigen.ke'
                    }
                }
            }
        }
        stage('Build') {
            parallel {
                stage('Build') {
                    steps {
                        sh 'echo "The build id is ${BUILD_URL}"'
                        sh 'echo "The build url is $BUILD_URL"'
                    }
                }

                stage('build dockee image') {
                    steps {
                        sh 'docker build -f my-portfolio/Dockerfile . -t kipgeoffry/my-portfolio:latest'
                    }
                }
            }
        }

        stage('Test') {
            steps {
                sh 'echo "Testing"'
                sh '''
                    ping 8.8.8.8 -c 4
                '''
                sh 'echo Test Completed'
            }
        }
    }
}
